<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Diary API í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f9; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1 { color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .api-section { margin-bottom: 25px; padding: 15px; border: 1px solid #ddd; border-radius: 6px; background-color: #fff; }
        .api-section h2 { color: #007bff; margin-top: 0; }
        input[type="text"], input[type="password"], textarea { width: 100%; padding: 10px; margin: 5px 0 15px 0; display: inline-block; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #28a745; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin-right: 10px; }
        button:hover { background-color: #218838; }
        #response-output { background-color: #f8f9fa; border: 1px solid #ced4da; padding: 15px; border-radius: 4px; white-space: pre-wrap; margin-top: 15px; max-height: 400px; overflow-y: scroll; }
        .token-display { font-weight: bold; color: #dc3545; }
    </style>
</head>
<body>

<div class="container">
    <h1>My Diary API í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸</h1>

    <p><strong>ğŸš¨ í˜„ì¬ í† í°:</strong> <span id="current-token" class="token-display">ì—†ìŒ</span></p>
    <p>í…ŒìŠ¤íŠ¸ ì „, Uvicorn ì„œë²„ê°€ <span class="token-display">http://127.0.0.1:8000</span>ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.</p>
    <hr>

    <div class="api-section">
        <h2>1. íšŒì›ê°€ì… (POST /api/v1/auth/register)</h2>
        <label for="reg_username">ì‚¬ìš©ìëª…:</label>
        <input type="text" id="reg_username" value="testuser">
        
        <label for="reg_password">ë¹„ë°€ë²ˆí˜¸:</label>
        <input type="password" id="reg_password" value="12345678">

        <label for="reg_email">ì´ë©”ì¼:</label>
        <input type="text" id="reg_email" value="test@example.com">
        
        <button onclick="registerUser()">íšŒì›ê°€ì… ì‹¤í–‰</button>
    </div>

    <div class="api-section">
        <h2>2. ë¡œê·¸ì¸ (POST /api/v1/auth/login)</h2>
        <label for="login_username">ì‚¬ìš©ìëª…:</label>
        <input type="text" id="login_username" value="testuser">
        
        <label for="login_password">ë¹„ë°€ë²ˆí˜¸:</label>
        <input type="password" id="login_password" value="12345678">
        
        <label for="login_email">ì´ë©”ì¼:</label>
        <input type="text" id="login_email" value="test@example.com">

        <button onclick="loginUser()">ë¡œê·¸ì¸ ì‹¤í–‰</button>
        <p><small>ë¡œê·¸ì¸ ì„±ê³µ ì‹œ, ìœ„ 'í˜„ì¬ í† í°'ì´ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.</small></p>
    </div>

    <div class="api-section">
        <h2>3. ëœë¤ ì§ˆë¬¸ ì¡°íšŒ (GET /api/v1/questions/random)</h2>
        <button onclick="getRandomQuestion()">ëœë¤ ì§ˆë¬¸ ì¡°íšŒ</button>
        <p><small>ì´ ê¸°ëŠ¥ì€ ë¡œê·¸ì¸ì´ í•„ìš”í•˜ë©°, DBì— ì§ˆë¬¸ ë°ì´í„°ê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</small></p>
    </div>

    <hr>
    <h2>API ì‘ë‹µ ê²°ê³¼</h2>
    <div id="response-output">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
</div>

<script>
    // ğŸš¨ ì„œë²„ í¬íŠ¸ê°€ 8000ì´ ì•„ë‹Œ ê²½ìš°, ì´ ê°’ì„ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.
    const API_BASE_URL = 'http://127.0.0.1:8000/api/v1';
    let ACCESS_TOKEN = '';

    function updateTokenDisplay(token) {
        ACCESS_TOKEN = token;
        document.getElementById('current-token').innerText = token ? token : 'ì—†ìŒ';
    }

    function displayResponse(title, status, data) {
        const output = document.getElementById('response-output');
        output.innerHTML = `
            <h3>${title} (${status})</h3>
            <pre>${JSON.stringify(data, null, 2)}</pre>
            <hr>` + output.innerHTML;
    }

    // --- 1. íšŒì›ê°€ì… ë¡œì§ ---
    async function registerUser() {
        const username = document.getElementById('reg_username').value;
        const password = document.getElementById('reg_password').value;
        const email = document.getElementById('reg_email').value;

        const url = `${API_BASE_URL}/auth/register`;
        const payload = { username, password, email };
        
        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const data = await response.json();
            displayResponse('íšŒì›ê°€ì… ê²°ê³¼', response.status, data);
        } catch (error) {
            displayResponse('íšŒì›ê°€ì… ê²°ê³¼', 'ERROR', { message: error.message });
        }
    }

    // --- 2. ë¡œê·¸ì¸ ë¡œì§ ---
    async function loginUser() {
        const username = document.getElementById('login_username').value;
        const password = document.getElementById('login_password').value;
        // ğŸ’¡ [ìˆ˜ì •] ì´ë©”ì¼ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
        const email = document.getElementById('login_email').value; 

        const url = `${API_BASE_URL}/auth/login`;
        // ğŸ’¡ [ìˆ˜ì •] ì´ë©”ì¼ì„ payloadì— í¬í•¨í•©ë‹ˆë‹¤. (422 ì˜¤ë¥˜ ë°©ì§€)
        const payload = { username, password, email };

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const data = await response.json();

            if (response.ok && data.access_token) {
                updateTokenDisplay(data.access_token);
                displayResponse('ë¡œê·¸ì¸ ì„±ê³µ & í† í° ì €ì¥', response.status, data);
            } else {
                updateTokenDisplay('');
                displayResponse('ë¡œê·¸ì¸ ì‹¤íŒ¨', response.status, data);
            }
        } catch (error) {
            displayResponse('ë¡œê·¸ì¸ ê²°ê³¼', 'ERROR', { message: error.message });
        }
    }

    // --- 3. ëœë¤ ì§ˆë¬¸ ë¡œì§ ---
    async function getRandomQuestion() {
        if (!ACCESS_TOKEN) {
            displayResponse('ëœë¤ ì§ˆë¬¸ ì¡°íšŒ ì‹¤íŒ¨', 401, { detail: "ë¨¼ì € ë¡œê·¸ì¸í•˜ì—¬ í† í°ì„ ë°œê¸‰ë°›ì•„ì•¼ í•©ë‹ˆë‹¤." });
            return;
        }

        const url = `${API_BASE_URL}/questions/random`;
        
        try {
            const response = await fetch(url, {
                method: 'GET',
                headers: { 
                    'Authorization': `Bearer ${ACCESS_TOKEN}`,
                    'Content-Type': 'application/json'
                }
            });
            const data = await response.json();
            displayResponse('ëœë¤ ì§ˆë¬¸ ì¡°íšŒ ê²°ê³¼', response.status, data);

        } catch (error) {
            displayResponse('ëœë¤ ì§ˆë¬¸ ì¡°íšŒ ê²°ê³¼', 'ERROR', { message: error.message });
        }
    }
</script>

</body>
</html>